# ğŸš€ Gen3: EfficientNet-V2-L @ 512 with Adaptive Pseudo-labeling
# ç›®æ¨™ï¼šæœ€çµ‚è¡åˆº 90%+ - è‡ªé©æ‡‰é–¾å€¼ + æ“´å±•å½æ¨™ç±¤é›†
# é æœŸé©—è­‰ F1: 89.0-90.0%
# é æœŸæ¸¬è©¦ F1: 89.5-91.0%

data:
  train_csv: data/fold{fold}_train_gen3.csv  # Gen3 è¨“ç·´é›† (å«è‡ªé©æ‡‰å½æ¨™ç±¤)
  val_csv: data/fold{fold}_val.csv
  file_col: new_filename
  label_cols: [normal, bacteria, virus, COVID-19]
  images_dir_train: train_images  # æœƒä½¿ç”¨ CSV ä¸­çš„ source_dir æ¬„ä½å‹•æ…‹åˆ‡æ›
  images_dir_val: train_images
  images_dir_test: test_images
  test_csv: data/test_data.csv
  num_classes: 4
  submission_cols: [normal, bacteria, virus, COVID-19]
  submission_file_col: new_filename

model:
  name: efficientnet_v2_l
  img_size: 512
  dropout: 0.40  # â†‘ é€²ä¸€æ­¥å¢åŠ  dropout (from 0.35) æ‡‰å°æ›´å¤šå½æ¨™ç±¤
  drop_path_rate: 0.30  # â†‘ å¢åŠ  stochastic depth

train:
  epochs: 55  # â†‘ å¢åŠ  epochs (from 50) å……åˆ†åˆ©ç”¨æ•¸æ“š
  batch_size: 4
  lr: 0.00007  # â†“ æ›´ä½å­¸ç¿’ç‡ (from 0.00008) å¾®èª¿éšæ®µ
  optimizer: adamw
  weight_decay: 0.0004  # â†‘ æ›´å¼·æ­£å‰‡åŒ– (from 0.0003)
  patience: 20  # â†‘ æ›´å¤§è€å¿ƒ (from 18)
  seed: 42
  num_workers: 4
  use_amp: true
  use_compile: false
  channels_last: true
  gradient_clip: 1.0

# æ•¸æ“šå¢å¼· - ä¿å®ˆï¼ˆå› ç‚ºå½æ¨™ç±¤è³ªé‡å¯èƒ½ä¸å¦‚ Gen2ï¼‰
augmentation:
  mixup_prob: 0.75  # â†“ ç¨é™ä½ (from 0.8) é¿å…éåº¦æ··åˆ
  mixup_alpha: 1.8  # â†“ ç¨é™ä½ (from 2.0)
  cutmix_prob: 0.55  # â†“ from 0.6
  aug_rotation: 22  # â†“ æ¸›å°‘æ—‹è½‰ (from 25)
  aug_scale: [0.82, 1.18]  # â†“ ç¸®å°ç¯„åœ
  random_erasing_prob: 0.40  # â†“ from 0.45
  h_flip_prob: 0.5
  v_flip_prob: 0.0

# Loss - é€²ä¸€æ­¥å¾®èª¿
loss:
  type: improved_focal
  focal_alpha: [1.0, 1.3, 2.2, 12.0]  # â†“ é™ä½å›°é›£é¡åˆ¥æ¬Šé‡ï¼ˆå½æ¨™ç±¤å¯èƒ½æœ‰å™ªéŸ³ï¼‰
  focal_gamma: 3.8  # â†“ ç¨é™ä½ (from 4.0)
  label_smoothing: 0.20  # â†‘ æ›´å¼· smoothing (from 0.18) æ‡‰å°å½æ¨™ç±¤å™ªéŸ³

# å­¸ç¿’ç‡èª¿åº¦
scheduler:
  type: cosine
  warmup_epochs: 5  # â†‘ æ›´é•· warmup (from 4)
  min_lr: 0.0000003  # â†“ æ›´ä½æœ€å°å­¸ç¿’ç‡

# SWA
swa:
  use_swa: true
  swa_start_epoch: 42  # â†‘ æ›´æ™šå•Ÿå‹• (from 38) ç¢ºä¿æ”¶æ–‚ç©©å®š
  swa_lr: 0.000035  # â†“ æ›´ä½ SWA å­¸ç¿’ç‡

# è¼¸å‡º
out:
  dir: outputs/v2l_512_gen3/fold{fold}
  submission_path: data/submission_v2l_512_gen3_fold{fold}.csv

# Gen3 ç‰¹æ®Šé…ç½®
gen3:
  use_adaptive_pseudo: true  # è‡ªé©æ‡‰é–¾å€¼ç­–ç•¥
  adaptive_thresholds:
    normal: 0.92      # ç°¡å–®é¡åˆ¥ï¼šè¼ƒé«˜é–¾å€¼
    bacteria: 0.90    # ç°¡å–®é¡åˆ¥ï¼šè¼ƒé«˜é–¾å€¼
    virus: 0.85       # å›°é›£é¡åˆ¥ï¼šè¼ƒä½é–¾å€¼
    COVID-19: 0.80    # æœ€å›°é›£é¡åˆ¥ï¼šæœ€ä½é–¾å€¼
  expected_pseudo_count: 800-900  # é æœŸå½æ¨™ç±¤æ•¸é‡
  min_confidence_avg: 0.92  # å¹³å‡æœ€ä½ç½®ä¿¡åº¦
  use_contrastive_loss: true  # å•Ÿç”¨å°æ¯”å­¸ç¿’ï¼ˆå€åˆ†çœŸå¯¦èˆ‡å½æ¨™ç±¤ï¼‰
  contrastive_weight: 0.1  # å°æ¯”æå¤±æ¬Šé‡
  description: "Adaptive threshold pseudo-labeling with contrastive learning for final 90%+ push"
