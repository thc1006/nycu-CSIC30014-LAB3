# ğŸ”¥ çµ‚æ¥µæ¦¨ä¹¾ GPU é…ç½® - GPU Caching + å¤§ Batch
# RTX 4070 Ti SUPER 16GB æ¥µé™é…ç½®

inherits: configs/base_colab.yaml

data:
  images_dir_train: train_images
  images_dir_val: val_images
  train_csv: data/fold0_train.csv
  val_csv: data/fold0_val.csv
  test_csv: data/test_data.csv
  file_col: new_filename
  label_cols: [normal, bacteria, virus, COVID-19]
  num_classes: 4

  # âš ï¸ GPU Caching æ¨¡å¼ä¸‹é†«å­¸é è™•ç†éœ€è¦ç‰¹æ®Šè™•ç†
  # ç›®å‰å…ˆé—œé–‰ï¼Œåœ¨ GPU ä¸Šåšå¢å¼·
  medical_preprocessing: false

train:
  seed: 42

  # ğŸš€ æ¥µé™é…ç½®
  epochs: 35
  batch_size: 64  # ğŸ”¥ é€²ä¸€æ­¥å¢åŠ åˆ° 64

  # âš¡ GPU Caching - æ¶ˆé™¤ I/O ç“¶é ¸
  use_gpu_cache: true  # ğŸš€ é—œéµï¼é è¼‰æ‰€æœ‰å½±åƒåˆ° GPU

  # å„ªåŒ–å™¨
  num_workers: 0  # GPU Cache ä¸éœ€è¦ workers
  lr: 0.00012  # é…åˆæ›´å¤§ batch
  weight_decay: 0.0005
  optimizer: adamw

  # å­¸ç¿’ç‡èª¿åº¦
  scheduler: cosine
  warmup_epochs: 3

  # è™•ç†ä¸å¹³è¡¡
  use_weighted_sampler: true

  # Focal Loss
  loss: improved_focal
  focal_alpha: [1.0, 2.0, 2.0, 20.0]
  focal_gamma: 3.0
  label_smoothing: 0.05

  # è³‡æ–™å¢å¼· (GPU åŸç”Ÿ)
  augment: true
  advanced_aug: true
  mixup_prob: 0.4
  mixup_alpha: 1.0
  cutmix_prob: 0.4
  cutmix_alpha: 1.0

  # é«˜ç´šå¢å¼·
  aug_rotation: 12
  aug_translate: 0.08
  aug_scale_min: 0.92
  aug_scale_max: 1.08
  aug_shear: 8
  random_erasing_prob: 0.25

  # SWA
  use_swa: true
  swa_start_epoch: 27
  swa_lr: 0.00005

perf:
  # ğŸš€ GPU å„ªåŒ–
  amp_dtype: fp16  # æ··åˆç²¾åº¦ç¯€çœ VRAM
  channels_last: true
  cudnn_benchmark: true
  tf32: high

model:
  name: efficientnet_b0  # ä½¿ç”¨ B0 ä»¥ç¯€çœ VRAM çµ¦ caching
  img_size: 320  # 320px å¹³è¡¡é€Ÿåº¦å’Œæº–ç¢ºåº¦
  pretrained: true

out:
  dir: outputs/ultimate_gpu/fold{fold_id}
  checkpoint_path: outputs/ultimate_gpu/fold{fold_id}/best.pt
  submission_path: data/submission_ultimate_fold{fold_id}.csv
