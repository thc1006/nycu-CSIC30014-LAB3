# ğŸš€ CAPR: EfficientNet-V2-L @ 512 with Category-Adaptive Pseudo-labels
# ç›®æ¨™ï¼šçªç ´ 90% - ä½¿ç”¨é¡åˆ¥è‡ªé©æ‡‰å½æ¨™ç±¤ä¿®å¾© Gen2 å¤±æ•—
# é æœŸé©—è­‰ F1: 89.0-90.0%

data:
  train_csv: data/fold{fold}_train_capr.csv  # CAPR è¨“ç·´é›† (å«è‡ªé©æ‡‰å½æ¨™ç±¤)
  val_csv: data/fold{fold}_val.csv
  file_col: new_filename
  label_cols: [normal, bacteria, virus, COVID-19]
  images_dir_train: train_images_capr  # æ··åˆç›®éŒ„ï¼ˆåŸå§‹ + å½æ¨™ç±¤ï¼‰
  images_dir_val: train_images
  images_dir_test: test_images
  test_csv: data/test_data.csv
  num_classes: 4
  submission_cols: [normal, bacteria, virus, COVID-19]
  submission_file_col: new_filename

model:
  name: efficientnet_v2_l
  img_size: 512
  dropout: 0.38  # â†‘ æ›´å¼· dropout é˜²æ­¢éæ“¬åˆåˆ°å½æ¨™ç±¤
  drop_path_rate: 0.28

train:
  epochs: 45  # é©ä¸­çš„ epochs
  batch_size: 4
  lr: 0.00007  # â†“ é™ä½å­¸ç¿’ç‡ï¼ˆå½æ¨™ç±¤è¨“ç·´éœ€è¦æ›´ç©©å®šï¼‰
  optimizer: adamw
  weight_decay: 0.00035  # â†‘ æ›´å¼·æ­£å‰‡åŒ–
  patience: 16
  seed: 42
  num_workers: 4
  use_amp: true
  use_compile: false
  channels_last: true
  gradient_clip: 1.0

# æ•¸æ“šå¢å¼· - å¹³è¡¡ç­–ç•¥
augmentation:
  mixup_prob: 0.75
  mixup_alpha: 1.8
  cutmix_prob: 0.55
  aug_rotation: 22
  aug_scale: [0.85, 1.15]
  random_erasing_prob: 0.40
  h_flip_prob: 0.5
  v_flip_prob: 0.0

# Loss - é‡å° CAPR èª¿æ•´
loss:
  type: improved_focal
  focal_alpha: [1.0, 1.5, 2.8, 18.0]  # â†‘ é€²ä¸€æ­¥æå‡ Virus å’Œ COVID-19 æ¬Šé‡
  focal_gamma: 4.2  # â†‘ æ›´å°ˆæ³¨å›°é›£æ¨£æœ¬
  label_smoothing: 0.20  # â†‘ æ›´å¼· smoothingï¼ˆå½æ¨™ç±¤å¯èƒ½æœ‰å™ªè²ï¼‰

# å­¸ç¿’ç‡èª¿åº¦
scheduler:
  type: cosine
  warmup_epochs: 5  # â†‘ æ›´é•· warmup
  min_lr: 0.0000003

# SWA
swa:
  use_swa: true
  swa_start_epoch: 35  # é©ä¸­å•Ÿå‹•
  swa_lr: 0.000035

# è¼¸å‡º
out:
  dir: outputs/v2l_512_capr/fold{fold}
  submission_path: data/submission_v2l_512_capr_fold{fold}.csv

# CAPR ç‰¹æ®Šé…ç½®
capr:
  use_adaptive_pseudo: true  # æ¨™è¨˜ä½¿ç”¨äº† CAPR å½æ¨™ç±¤
  adaptive_thresholds:
    normal: 0.92      # ç°¡å–®é¡åˆ¥ï¼šè¼ƒé«˜é–¾å€¼
    bacteria: 0.90
    virus: 0.85       # å›°é›£é¡åˆ¥ï¼šè¼ƒä½é–¾å€¼
    COVID-19: 0.80    # æœ€å›°é›£é¡åˆ¥ï¼šæœ€ä½é–¾å€¼
  quality_control: true  # å•Ÿç”¨è³ªé‡æ§åˆ¶
  min_quality_score: 0.85
  max_per_class: [150, 200, 150, 50]  # æ¯é¡æœ€å¤§æ¨£æœ¬æ•¸ï¼ˆé˜²æ­¢é ­éƒ¨ä¸»å°ï¼‰
  description: "Category-Adaptive Pseudo-label Regulation with quality control"
