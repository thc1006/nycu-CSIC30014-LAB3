# K-Fold Cross Validation é…ç½® + é†«å­¸å½±åƒé è™•ç†
# ç›®æ¨™: æ¸›å°‘éæ“¬åˆï¼Œæå‡æ¸¬è©¦é›†æ³›åŒ–èƒ½åŠ›
# ç­–ç•¥: 5-Fold CV + CLAHE + æ›´å¼·æ­£å‰‡åŒ–

inherits: configs/base_colab.yaml

data:
  # K-Fold æœƒå‹•æ…‹è¨­ç½®é€™äº›è·¯å¾‘
  images_dir_train: train_images  # æœƒè¢« train.py å‹•æ…‹ä¿®æ”¹
  images_dir_val: val_images      # æœƒè¢« train.py å‹•æ…‹ä¿®æ”¹
  train_csv: data/fold0_train.csv  # å‹•æ…‹è¨­ç½®
  val_csv: data/fold0_val.csv      # å‹•æ…‹è¨­ç½®
  test_csv: data/test_data.csv
  file_col: new_filename
  label_cols: [normal, bacteria, virus, COVID-19]
  num_classes: 4

  # ğŸ¥ é†«å­¸å½±åƒé è™•ç†
  medical_preprocessing: true
  preprocessing_preset: default  # default | aggressive | conservative

train:
  seed: 42

  # ğŸ¯ æ¸›å°‘éæ“¬åˆ - è¼ƒçŸ­è¨“ç·´
  epochs: 30  # å¾ 40 é™åˆ° 30
  batch_size: 24  # ç•¥å¢åŠ ä»¥åŠ å¿«è¨“ç·´

  # å„ªåŒ–å™¨é…ç½®
  num_workers: 8
  lr: 0.00008  # ç•¥é™ä½å­¸ç¿’ç‡
  weight_decay: 0.0005  # å¢åŠ æ¬Šé‡è¡°æ¸›ï¼ˆå¾ 0.0001ï¼‰
  optimizer: adamw

  # å­¸ç¿’ç‡èª¿åº¦
  scheduler: cosine
  warmup_epochs: 3  # ç¸®çŸ­ warmup

  # é—œéµï¼šè™•ç†æ¥µåº¦ä¸å¹³è¡¡
  use_weighted_sampler: true

  # ğŸ¯ å„ªåŒ– Focal Loss æ¬Šé‡
  loss: improved_focal
  focal_alpha: [1.0, 2.0, 2.0, 20.0]  # COVID-19 æ¬Šé‡å¾ 15.0 â†’ 20.0
  focal_gamma: 3.0
  label_smoothing: 0.05  # é™ä½ï¼ˆå¾ 0.1ï¼‰ä»¥æ¸›å°‘éæ“¬åˆ

  # ğŸ”¥ ä¿æŒæ¿€é€²çš„è³‡æ–™å¢å¼·
  augment: true
  advanced_aug: true
  mixup_prob: 0.4  # ç•¥é™ä½
  mixup_alpha: 1.0
  cutmix_prob: 0.4  # ç•¥é™ä½
  cutmix_alpha: 1.0

  # é«˜ç´šå¢å¼·åƒæ•¸
  aug_rotation: 12  # é™ä½ï¼ˆå¾ 15ï¼‰
  aug_translate: 0.08  # é™ä½ï¼ˆå¾ 0.1ï¼‰
  aug_scale_min: 0.92  # æ›´ä¿å®ˆ
  aug_scale_max: 1.08
  aug_shear: 8  # é™ä½ï¼ˆå¾ 10ï¼‰
  random_erasing_prob: 0.25  # é™ä½ï¼ˆå¾ 0.3ï¼‰

  # ğŸŒŸ SWA - å¾æ›´æ—©é–‹å§‹
  use_swa: true
  swa_start_epoch: 22  # å¾ 30 â†’ 22
  swa_lr: 0.00004  # ç•¥é™ä½

perf:
  # ğŸš€ æ··åˆç²¾åº¦è¨“ç·´
  amp_dtype: fp16
  channels_last: true
  cudnn_benchmark: true
  tf32: high

model:
  # ğŸ¯ ä½¿ç”¨ç¨å°çš„æ¨¡å‹æ¸›å°‘éæ“¬åˆ
  name: efficientnet_b0  # å¾ efficientnet_v2_s æ”¹ç‚º b0
  img_size: 320  # å¾ 384 é™åˆ° 320ï¼ˆåŠ å¿«è¨“ç·´ï¼‰
  pretrained: true
  # dropout åœ¨ EfficientNet ä¸­å·²å…§å»ºï¼Œç„¡éœ€é¡å¤–è¨­ç½®

out:
  dir: outputs/kfold_run/fold{fold_id}
  checkpoint_path: outputs/kfold_run/fold{fold_id}/best.pt
  submission_path: data/submission_kfold_fold{fold_id}.csv
