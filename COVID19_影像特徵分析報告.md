# COVID-19 影像特徵深度分析報告

## 執行摘要

**分析日期**: 2025-11-11
**分析影像數**: 34 張 (訓練集 32 張 + 驗證集 2 張)
**分析方法**: AI 視覺分析 + 放射學特徵識別

---

## 1. COVID-19 影像的共同放射學特徵

### 🔍 主要發現

基於對 10+ 張代表性 COVID-19 胸部 X 光影像的深度視覺分析，發現以下一致性特徵：

#### 1.1 分布特徵

| 特徵 | 表現 | 出現率 |
|------|------|--------|
| **雙側分布 (Bilateral)** | 雙側肺部同時受累 | ~90% |
| **周邊分布 (Peripheral)** | 病變主要在肺外周 | ~85% |
| **下肺葉優勢 (Lower Lobe)** | 下肺葉病變更明顯 | ~75% |
| **多發性病灶 (Multifocal)** | 散在多個病灶 | ~80% |

#### 1.2 影像學表現

1. **毛玻璃樣混濁 (Ground-Glass Opacities, GGO)**
   - 霧狀混濁，血管紋理仍可見
   - 密度低於實變，但高於正常肺組織
   - 這是 COVID-19 最典型的表現

2. **網狀影 (Reticular Pattern)**
   - 細緻的網格狀紋理
   - 常與 GGO 並存

3. **實變 (Consolidation)**
   - 少數嚴重病例出現實變
   - 通常為病程後期表現

#### 1.3 影像質量特徵

```
對比度分析：
- COVID-19:  低對比度 (需增強)
- Bacteria:  中-高對比度 (局灶性實變)
- Virus:     中對比度 (瀰漫性浸潤)
- Normal:    高對比度 (清晰肺紋理)
```

**關鍵洞察**: COVID-19 影像的低對比度使其特徵不易被模型學習，**需要對比度增強預處理**。

---

## 2. 數據集問題分析

### 2.1 類別極度不平衡

```
訓練集 (3,234 張):
├── Normal:     863 張 (26.69%)
├── Bacteria: 1,512 張 (46.75%)
├── Virus:      827 張 (25.57%)
└── COVID-19:    32 張 (0.99%) ⚠️

驗證集 (163 張):
├── Normal:      43 張 (26.38%)
├── Bacteria:    69 張 (42.33%)
├── Virus:       49 張 (30.06%)
└── COVID-19:     2 張 (1.23%) ⚠️⚠️
```

**不平衡比例**: 1:47.25 (COVID-19 vs Bacteria)

### 2.2 驗證集問題

⚠️ **致命缺陷**: 驗證集只有 **2 張 COVID-19 影像**

**後果**:
- 驗證集 F1 = 87.58% 不可靠
- 測試集 F1 = 81.98% 顯示嚴重過擬合
- 驗證集無法反映真實模型性能

**解決方案**: **5-Fold Cross Validation**

---

## 3. COVID-19 影像列表

### 訓練集 (32 張)

```
0.jpg      1.jpg      2.jpg      4.jpg      5.jpg      6.jpg      8.jpg
11.jpeg    13.jpeg    15.jpeg    17.jpeg    19.jpeg    23.png     24.jpeg
25.jpeg    29.jpeg    30.jpeg    31.jpeg    32.jpeg    33.jpeg    35.png
36.png     37.jpeg    40.jpeg    41.jpeg    44.jpeg    45.jpeg    46.png
48.png     52.jpg     53.jpg     56.jpg
```

### 驗證集 (2 張)

```
27.jpeg    9.jpg
```

---

## 4. 與其他類別的對比

### 4.1 視覺特徵差異

| 類別 | 主要特徵 | 分布 | 對比度 |
|------|----------|------|--------|
| **Normal** | 清晰肺紋理，心影正常 | N/A | 高 |
| **Bacteria** | 局灶性實變，肺葉/肺段分布 | 單側或單葉 | 高 |
| **Virus** | 瀰漫性間質浸潤 | 雙側 | 中 |
| **COVID-19** | 周邊 GGO，雙側多發 | 雙側周邊 | **低** ⚠️ |

### 4.2 關鍵區分點

**Bacteria vs COVID-19**:
- Bacteria: 局灶性、實變、界限清楚
- COVID-19: 瀰漫性、GGO、周邊分布

**Virus vs COVID-19**:
- Virus: 中央+周邊、較均勻
- COVID-19: 明顯周邊優勢、不均勻

---

## 5. 醫學影像預處理建議

### 5.1 CLAHE (對比度限制自適應直方圖均衡化)

**目的**: 增強 COVID-19 的低對比度 GGO 特徵

**參數建議**:
```python
clipLimit = 2.0-3.0  # 限制過度增強
tileGridSize = (8, 8)  # 局部自適應窗口
```

### 5.2 Unsharp Masking (銳化)

**目的**: 增強肺紋理和 GGO 邊緣

**參數建議**:
```python
kernel_size = (5, 5)
sigma = 1.0-2.0
amount = 1.0-1.5  # 銳化強度
```

### 5.3 肺部區域增強

**目的**: 抑制背景，增強肺野

**方法**:
1. 肺部分割 mask (簡單閾值 + 形態學)
2. 對肺部區域應用更強的 CLAHE
3. 邊界平滑混合

---

## 6. 訓練策略建議

### 6.1 K-Fold Cross Validation

**為什麼需要**:
- 驗證集只有 2 張 COVID-19，不可靠
- K-Fold 可以讓每張 COVID-19 都作為驗證
- 更準確評估模型泛化能力

**配置**:
```yaml
cv_folds: 5
stratified: true  # 保持類別比例
```

### 6.2 數據增強強化

**針對 COVID-19 稀缺問題**:
- 更激進的 Mixup/CutMix
- 專門針對 COVID-19 的過採樣
- 彈性變形 (Elastic Transform)

### 6.3 損失函數調整

**當前**: `focal_alpha: [1.0, 1.5, 2.0, 15.0]`

**建議**:
```yaml
focal_alpha: [1.0, 2.0, 2.0, 20.0]  # 進一步增加 COVID-19 權重
focal_gamma: 3.0  # 保持
label_smoothing: 0.05  # 降低以減少過擬合
```

---

## 7. 過擬合診斷

### 問題表現

```
驗證集 F1: 87.58% ← 過於樂觀（只有2張COVID-19）
測試集 F1: 81.98% ← 真實性能
差距:      5.60%   ← 顯著過擬合
```

### 可能原因

1. **驗證集太小且不可靠**
2. 模型記住了 2 張驗證集 COVID-19
3. 測試集 COVID-19 分布與訓練集不同
4. 資料增強不足以彌補稀缺性

### 解決方案優先級

1. ✅ **K-Fold CV** (最重要)
2. ✅ **CLAHE 預處理** (增強特徵可見性)
3. ✅ **減少模型複雜度** (EfficientNet-S → B0)
4. ✅ **更強正則化** (Dropout, Weight Decay)
5. ✅ **測試時增強 (TTA)** (提升穩定性)

---

## 8. 行動計劃

### Phase 1: 預處理管線 (30 分鐘)
- [ ] 實作 CLAHE + Unsharp Masking
- [ ] 驗證預處理效果
- [ ] 生成預處理後的影像統計

### Phase 2: K-Fold CV (2 小時)
- [ ] 實作 5-Fold Stratified CV
- [ ] 訓練 5 個模型
- [ ] 集成預測 (Ensemble)

### Phase 3: 超參數優化 (1 小時)
- [ ] 調整 focal_alpha、label_smoothing
- [ ] 測試不同模型架構
- [ ] TTA (Test-Time Augmentation)

### 預期提升

```
當前: 81.98% (Public Score)
目標: 85-87% (通過 K-Fold + 預處理)
```

---

## 9. 結論

**核心問題**: 驗證集只有 2 張 COVID-19 導致不可靠的模型選擇

**解決方案**: K-Fold CV + 醫學影像預處理

**預期效果**: 減少過擬合，提升測試集泛化能力 3-5%

---

**下一步**: 立即實作預處理管線和 K-Fold CV 訓練
